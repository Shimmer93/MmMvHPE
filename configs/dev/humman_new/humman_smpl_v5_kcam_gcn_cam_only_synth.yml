strategy: ddp
benchmark: true
deterministic: false
pretrained: false
sync_batchnorm: false
clip_grad: null
precision: 16
epochs: &epochs 20
camera_only: true
monitor: 'val_cam_pose_auc_30_rgb'
monitor_mode: 'max'
# --------------------------------------
# Dataset parameters
# --------------------------------------
train_dataset:
  name: 'HummanPreprocessedDatasetV2'
  params:
    data_root: &data_root '/opt/data/humman_cropped'
    unit: 'm'
    modality_names: ['rgb', 'depth']
    rgb_cameras: ['kinect_000', 'kinect_001', 'kinect_002', 'kinect_003', 'kinect_004', 'kinect_005', 'kinect_006', 'kinect_007', 'kinect_008', 'kinect_009', 'iphone']
    depth_cameras: ['kinect_000', 'kinect_001', 'kinect_002', 'kinect_003', 'kinect_004', 'kinect_005', 'kinect_006', 'kinect_007', 'kinect_008', 'kinect_009', 'iphone']
    split: 'train'
    split_config: 'configs/datasets/humman_split_config.yml'
    split_to_use: 'cross_camera_split'
    test_mode: false
    seq_len: 1
    seq_step: 1
    pad_seq: true
    causal: true
    use_all_pairs: false
    colocated: false
val_dataset:
  name: 'HummanPreprocessedDatasetV2'
  params:
    data_root: *data_root
    unit: 'm'
    modality_names: ['rgb', 'depth']
    rgb_cameras: ['kinect_000', 'kinect_001', 'kinect_002', 'kinect_003', 'kinect_004', 'kinect_005', 'kinect_006', 'kinect_007', 'kinect_008', 'kinect_009', 'iphone']
    depth_cameras: ['kinect_000', 'kinect_001', 'kinect_002', 'kinect_003', 'kinect_004', 'kinect_005', 'kinect_006', 'kinect_007', 'kinect_008', 'kinect_009', 'iphone']
    split: 'test'
    split_config: 'configs/datasets/humman_split_config.yml'
    split_to_use: 'cross_camera_split'
    test_mode: true
    seq_len: 1
    seq_step: 1
    pad_seq: true
    causal: true
    use_all_pairs: false
    colocated: false
test_dataset:
  name: 'HummanPreprocessedDatasetV2'
  params:
    data_root: *data_root
    unit: 'm'
    modality_names: ['rgb', 'depth']
    rgb_cameras: ['kinect_000', 'kinect_001', 'kinect_002', 'kinect_003', 'kinect_004', 'kinect_005', 'kinect_006', 'kinect_007', 'kinect_008', 'kinect_009', 'iphone']
    depth_cameras: ['kinect_000', 'kinect_001', 'kinect_002', 'kinect_003', 'kinect_004', 'kinect_005', 'kinect_006', 'kinect_007', 'kinect_008', 'kinect_009', 'iphone']
    split: 'test'
    split_config: 'configs/datasets/humman_split_config.yml'
    split_to_use: 'cross_camera_split'
    test_mode: true
    seq_len: 1
    seq_step: 1
    pad_seq: true
    causal: true
    use_all_pairs: true
    colocated: false
# --------------------------------------
# Optimizer parameters
# --------------------------------------
optim_name: AdamW
optim_params:
  lr: &lr 0.0001
  weight_decay: 0.00001
# --------------------------------------
# Learning rate scheduler parameters
# --------------------------------------
sched_name: LinearWarmupCosineAnnealingLR
sched_params:
  warmup_epochs: 4
  max_epochs: *epochs
  warmup_start_lr: 0.00001
  eta_min: 0.00001
# --------------------------------------
# Model parameters
# --------------------------------------
model_name: HummanCameraGCNOnly
camera_head:
  name: 'KeypointCameraGCNHeadV5'
  params:
    num_joints: 24
    hidden_dim: 256
    num_layers: 4
    dropout: 0.1
    use_layernorm: true
    use_modality_embedding: true
    detach_inputs: true
    use_gt_ratio: 0.0
    num_iterations: 4
    pose_encoding_type: "absT_quaR_FoV"
    proj_loss_weight_rgb: 0.1
    proj_loss_weight_lidar: 0.1
    proj_loss_type: "l1"
    gcn_depth: 3
    losses:
      - name: 'CameraLoss'
        params:
          loss_type: 'l1'
          weights: [1.0, 1.0, 0]
        weight: 1.0
# --------------------------------------
# Metrics parameters
# --------------------------------------
metrics:
  - name: 'CameraPoseAUC'
    params:
      modality: 'rgb'
      max_threshold: 30
    alias: 'CameraPoseAUC_rgb'
  - name: 'CameraPoseAUC'
    params:
      modality: 'lidar'
      max_threshold: 30
    alias: 'CameraPoseAUC_lidar'
  - name: 'CameraTranslationL2Error'
    params:
      modality: 'rgb'
    alias: 'CameraTransL2_rgb'
  - name: 'CameraTranslationL2Error'
    params:
      modality: 'lidar'
    alias: 'CameraTransL2_lidar'
  - name: 'CameraRotationAngleError'
    params:
      modality: 'rgb'
    alias: 'CameraRotAngle_rgb'
  - name: 'CameraRotationAngleError'
    params:
      modality: 'lidar'
    alias: 'CameraRotAngle_lidar'
# --------------------------------------
# Augmentation parameters
# --------------------------------------
train_pipeline: &train_pipeline
  - name: ReplaceBySyntheticCamera
    params:
      synthetic_prob: 0.5
      rot_jitter_deg: 10.0
      trans_jitter: 0.1
      focal_scale: [0.8, 1.2]
      modalities: ['rgb', 'lidar']
  - name: CameraParamToPoseEncoding
    params:
      pose_encoding_type: "absT_quaR_FoV"
  - name: SyncKeypointsWithCameraEncoding
    params:
      pose_encoding_type: "absT_quaR_FoV"
  - name: PCCenterWithKeypoints
    params:
      center_type: 'mean'
      keys: ['input_lidar']
      keypoints_key: 'gt_keypoints'
  - name: AddKeypointNoise
    params:
      noise_std_3d: 0.05
      noise_std_2d: 0.01
      apply_to_global: true
  - name: VideoNormalize
    params:
      norm_mode: 'imagenet'
      keys: ['input_rgb']
  - name: PCPad
    params:
      num_points: 1024
      pad_mode: 'repeat'
      keys: ['input_lidar']
  - name: ToTensor
    params: null
val_pipeline: &val_pipeline
  - name: ReplaceBySyntheticCamera
    params:
      synthetic_prob: 0.0
      rot_jitter_deg: 5.0
      trans_jitter: 0.05
      focal_scale: [0.8, 1.2]
      modalities: ['rgb', 'lidar']
  - name: CameraParamToPoseEncoding
    params:
      pose_encoding_type: "absT_quaR_FoV"
  - name: SyncKeypointsWithCameraEncoding
    params:
      pose_encoding_type: "absT_quaR_FoV"
  - name: PCCenterWithKeypoints
    params:
      center_type: 'mean'
      keys: ['input_lidar']
      keypoints_key: 'gt_keypoints'
  - name: VideoNormalize
    params:
      norm_mode: 'imagenet'
      keys: ['input_rgb']
  - name: PCPad
    params:
      num_points: 1024
      pad_mode: 'repeat'
      keys: ['input_lidar']
  - name: ToTensor
    params: null
test_pipeline: *val_pipeline
