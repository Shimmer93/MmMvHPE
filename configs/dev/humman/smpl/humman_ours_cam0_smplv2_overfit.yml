strategy: ddp
benchmark: true
deterministic: false
pretrained: false
sync_batchnorm: false
clip_grad: null
precision: 32
max_steps: &max_steps 200
val_check_interval: 1
limit_val_batches: 1
batch_size: 1
batch_size_eva: 1
freeze_backbones: true
freeze_aggregator: true

# --------------------------------------
# Dataset parameters
# --------------------------------------
train_dataset:
  name: 'HummanPreprocessedDataset'
  params:
    data_root: &data_root '/opt/data/humman'
    unit: 'm'
    modality_names: ['rgb', 'depth']
    rgb_cameras: null
    depth_cameras: null
    anchor_key: 'input_rgb'
    split: "train"
    seq_len: 1
    seq_step: 5
    pad_seq: true
    causal: true
    use_all_pairs: true
    random_seed: 42
    max_samples: 1
val_dataset:
  name: 'HummanPreprocessedDataset'
  params:
    data_root: *data_root
    unit: 'm'
    modality_names: ['rgb', 'depth']
    rgb_cameras: null
    depth_cameras: null
    anchor_key: 'input_rgb'
    split: "train"
    seq_len: 1
    seq_step: 5
    pad_seq: true
    causal: true
    use_all_pairs: true
    random_seed: 42
    max_samples: 1
test_dataset:
  name: 'HummanPreprocessedDataset'
  params:
    data_root: *data_root
    unit: 'm'
    modality_names: ['rgb', 'depth']
    rgb_cameras: null
    depth_cameras: null
    anchor_key: 'input_rgb'
    split: "train"
    seq_len: 1
    seq_step: 5
    pad_seq: true
    causal: true
    use_all_pairs: true
    random_seed: 42
    max_samples: 1
# --------------------------------------
# Optimizer parameters
# --------------------------------------
optim_name: AdamW
optim_params:
  lr: &lr 0.0005
  weight_decay: 0.00001
# --------------------------------------
# Learning rate scheduler parameters
# --------------------------------------
sched_name: OneCycleLR
sched_params:
  max_lr: *lr
  total_steps: *max_steps
  pct_start: 0.01  # 1% warmup
  anneal_strategy: 'cos'
  div_factor: 10.0
  final_div_factor: 10000.0
# --------------------------------------
# Model parameters
# --------------------------------------
model_name: TestModel_1208
backbone_rgb:
  name: 'TimmWrapper'
  params:
    model_name: 'vit_small_patch16_dinov3'
    pretrained: true
  has_temporal: false
backbone_depth:
  name: 'TimmWrapper'
  params:
    model_name: 'vit_small_patch16_dinov3'
    pretrained: true
  has_temporal: false
aggregator:
  name: 'TransformerAggregator'
  params:
    input_dims: [384, 384, 512, 512]
    embed_dim: 256
    num_register_tokens: 4
    aa_order: ['single', 'global', 'cross']
    aa_block_size: 1
    depth: 6
    block_type: 'Block'
    num_heads: 8
    mlp_ratio: 2.0
    qkv_bias: true
    proj_bias: true
    ffn_bias: true
    qk_norm: true
    init_values: 0.01
smpl_head:
  name: 'SMPLHeadV2'
  params:
    emb_size: 768
    hidden_dims: [1024, 512]
    num_betas: 10
    dropout: 0.1
    activation: 'gelu'
    use_smpl_mean: false
    smpl_model_path: 'weights/basicModel_neutral_lbs_10_207_0_v1.0.0.pkl'
    joint_loss_type: 'l1'
    rot_weight: 1.0
    root_rot_weight: 1.0
    body_rot_weight: 1.0
    use_simple_rot_loss: true
    simple_rot_weight: 1.0
    joint_weight: 1
    transl_weight: 10.0
    betas_weight: 1.0
    debug: true
    debug_every: 1
# --------------------------------------
# Metrics parameters
# --------------------------------------
metrics:
  - name: 'SMPL_MPJPE'
    params:
      smpl_model_path: 'weights/basicModel_neutral_lbs_10_207_0_v1.0.0.pkl'
      affix: null
  - name: 'SMPL_PAMPJPE'
    params:
      smpl_model_path: 'weights/basicModel_neutral_lbs_10_207_0_v1.0.0.pkl'
      affix: null
  - name: 'SMPL_VertexError'
    params:
      smpl_model_path: 'weights/basicModel_neutral_lbs_10_207_0_v1.0.0.pkl'
      affix: null

# --------------------------------------
# Augmentation parameters
# --------------------------------------
train_pipeline: &train_pipeline
  - name: VideoResize
    params:
      size: [256, 256]
      keep_ratio: false
      keys: ['input_rgb', 'input_depth']
  - name: VideoNormalize
    params:
      norm_mode: 'imagenet'
      keys: ['input_rgb']
  - name: VideoNormalize
    params:
      norm_mode: 'zero_one'
      keys: ['input_depth']
  - name: ToTensor
    params: null
  - name: CameraParamToPoseEncoding
    params: null
val_pipeline: *train_pipeline
test_pipeline: *train_pipeline
vis_skl_format: 'smpl'  # Skeleton format for visualization
vis_denorm_params:
  rgb_mean: [123.675, 116.28, 103.53]  # ImageNet mean in 0-255 range
  rgb_std: [58.395, 57.12, 57.375]      # ImageNet std in 0-255 range
  depth_mean: [0.0]
  depth_std: [255.0]  # zero_one normalization
